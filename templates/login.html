<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VulnZero - Login</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Parkinsans:wght@300..800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <style type="text/tailwindcss">
    @theme {
      --color-clifford: #da373d;
      --color-text: #030303;
      --color-purp: #7257ff;
    }
  </style>
  <body class="bg-white">
    <section class="flex h-screen">
      <!-- Image bg -->
      <div class="basis-2/5 bg-red-400 login-bg"></div>

      <!-- Main -->
      <div class="basis-full flex flex-col justify-center items-center bg-main">
        <h1 class="text-3xl font-semibold">Login to VulnZero</h1>
        <div id="message"></div>
        <form class="flex w-1/3 flex-col my-5" id="loginForm">
          <input
            class="border bg-white border-neutral-400 px-3 py-1.5 rounded-md w-full"
            type="text"
            id="username"
            placeholder="Username"
            required
          />
          <input
            class="border bg-white border-neutral-400 px-3 mt-5 py-1.5 rounded-md w-full"
            type="password"
            id="password"
            placeholder="Password"
            required
          />
          <div
            id="spinner"
            hidden
            class="my-2 flex flex-col items-center gap-3 text-purp"
          >
            <div
              class="h-8 w-8 rounded-full border-4 border-purp/30 border-t-purp animate-spin"
            ></div>
            <p class="text-sm font-medium">Logging In...</p>
          </div>
          <button
            class="mt-10 rounded-xl bg-purp px-8 py-3 text-white"
            type="submit"
          >
            Login
          </button>
          
        </form>
        <p>
          Don't have an account?
          <button
            class="text-sm text-purp"
            onclick="window.location.href='/templates/register'"
          >
            Register
          </button>
        </p>
        <!-- <p><a class="text-sm text-purp" href="{{url_for('home')}}">Back to Home</a></p> -->
      </div>
    </section>
    <script>
      // Flask server URL - change this if your Flask server runs on a different port
      const API_BASE_URL = "http://127.0.0.1:5000";

      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;
          const messageDiv = document.getElementById("message");
          const spinner = document.getElementById("spinner");
          spinner.hidden = false;
          try {
            const response = await fetch(`${API_BASE_URL}/templates/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              credentials: "include",
              body: JSON.stringify({ username, password }),
            });

            if (!response.ok) {
              const errorText = await response.text();
              console.error("Response error:", response.status, errorText);
              spinner.hidden = true;
              messageDiv.className = "text-red-500 text-sm my-2";
              messageDiv.textContent = `Error ${response.status}: ${
                errorText || response.statusText
              }`;
              return;
            }

            const data = await response.json();
            console.log("Login response:", data);

            if (data.status === "true") {
              spinner.hidden = true;
              messageDiv.className = "text-purp text-sm my-2";
              messageDiv.textContent = data.message;
              setTimeout(
                () => (window.location.href = "/templates/dashboard"),
                1000
              );
            } else {
              spinner.hidden = true;
              messageDiv.className = "message error";
              messageDiv.textContent = data.message;
            }
          } catch (error) {
            console.error("Login error:", error);
            spinner.hidden = true;
            messageDiv.className = "message error";
            messageDiv.textContent = `Network error: ${error.message}. Make sure the Flask server is running.`;
          }
        });
    </script>
  </body>
</html>
